<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="favicon.png">
    <title>Weather Outlook</title>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.27.0/moment.min.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.1/css/all.css"
        integrity="sha384-vp86vTRFVJgpjF9jiIGPEEqYqlDwgyBgEF109VFjmqGmIY/Y4HV4d3Gp2irVfcrp" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css2?family=Old+Standard+TT&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <header>
        <h1>Weather Dashboard</h1>
    </header>
    <section>
        <div class="search-field">
            <div class="search-bar">
                <form>
                    <label for="city">Search for a City:</label>
                    <br>
                    <input type="text" id="city" name="city">
                    <button type="button" id="search-button" class="btn btn-outline-info"><i class="fas fa-search"></i>
                    </button>
                </form>
            </div>
            <div class="city-list"></div>
        </div>
        <div class="weather-display">
            <div class="weather-info">
                <ul class="cityList">
                </ul>
            </div>
            <div class="weather-imgs">
                <h2>5-Day Forecast</h2>
                <div class="weather-imgs-content"></div>
            </div>
        </div>
    </section>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript">

        var queryURLBase = "http://api.openweathermap.org/data/2.5/forecast?q=";
        var imperialUnits = "&units=imperial";
        var apiKey = "&appid=086828ce404d02fbf057835f64951922";

        var userCity = "";

        //ajax request to get info
        function runQuery(queryURL) {

            $(".weather-info").empty();
            $(".weather-imgs-content").empty();

            $.ajax({
                url: queryURL,
                method: "GET"
            }).done(function (weatherData) {

                //add to html
                var weatherInfoSection = $("<div>");
                weatherInfoSection.addClass("weather");
                $(".weather-info").append(weatherInfoSection);

                var cityItem = $("<li>");
                cityItem.addClass("city");
                $(".city-list").append(cityItem);

                var weatherDataDate = weatherData.list[0].dt_txt.toString().slice(0, 10);

                $(".city").append("<h2>" + weatherData.city.name + "</h2>");
                $(".weather").append("<h3>" + weatherData.city.name + " " + weatherDataDate + "</h3>");
                $(".weather").append("<h5>" + "Temperature: " + weatherData.list[0].main.temp + "F" + "</h5>");
                $(".weather").append("<h5>" + "Humidity: " + weatherData.list[0].main.humidity + "%" + "</h5>");
                $(".weather").append("<h5>" + "Wind Speed " + weatherData.list[0].wind.speed + " MPH" + "</h5>");

                for (var i = 1; i < 35; i += 8) {
                    var dailyWeather = $("<div>");
                    dailyWeather.addClass("weatherslot")
                    dailyWeather.attr("id", "slot-" + i);
                    $(".weather-imgs-content").append(dailyWeather);

                    var littleWeatherDate = weatherData.list[i].dt_txt.toString().slice(0, 10);
                    var weatherIcon = "http://openweathermap.org/img/w/" + weatherData.list[i].weather[0].icon + ".png";

                    $("#slot-" + i).append("<h6>" + littleWeatherDate + "</h6>");
                    $("#slot-" + i).append("<img src=" + weatherIcon + ">");
                    $("#slot-" + i).append("<h6>" + "Temperature: " + weatherData.list[i].main.temp + "F" + "</h6>");
                    $("#slot-" + i).append("<h6>" + "Humidity: " + weatherData.list[i].main.humidity + "%" + "</h6>");

                }

            });

        }


        //onclick event for search button
        $('#search-button').on("click", function () {

            var userCity = $("#city").val().trim();

            var newUrl = queryURLBase + userCity + imperialUnits + apiKey;

            runQuery(newUrl);
            return false;
        });



    </script>
</body>

</html>